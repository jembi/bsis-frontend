<span class="h4">Add Donation</span>
<hr style="margin-top:8px;"/>

<div ng-if="$parent.addDonationSuccess === false" ng-hide="$parent.addDonationSuccess !== false" style="padding-top:10px;">
    <alert type="danger" close="">Error Adding Donation, please resolve issues and try again.</alert>
</div>

<form name="addDonationForm" novalidate class="form-horizontal col-sm-12" role="form" ng-submit="addDonation(donation, bleedStartTime, bleedEndTime, addDonationForm.$valid)">

  <div class="col-md-4">

    <p><em>Donation Information</em></p>
    <hr style="margin-top:8px;"/>

    <div class="form-group">
      <label for="donorNumber" class="col-sm-3 control-label">Donor #</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <input name="donorNumber" size="15" type="donorNumber" id="donorNumber" class="form-control input-sm" placeholder="" ng-model="donation.donorNumber" required integer ng-maxlength=6
          ng-model-options="{ updateOn:'default blur', debounce: { default: 500, blur: 0 } }"
          ng-class="{'ng-invalid ng-dirty' : (addDonationForm.donorNumber.$invalid && submitted) || err['donation.donor']}"
          >
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.donorNumber.$error.required && (addDonationForm.donorNumber.$dirty || submitted))
              ">
              This cannot be empty
            </small>
          </div>
          <div>
            <small class="error"
              ng-show="
                (!addDonationForm.donorNumber.$error.required && addDonationForm.donorNumber.$invalid && (addDonationForm.donorNumber.$dirty || submitted))
              ">
              Invalid input
            </small>
              <small class="error" ng-show="err['donation.donor']">
                  {{err["donation.donor"]}}
              </small>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="name" class="col-sm-3 control-label"> </label>
      <div class="row col-sm-9">
        <div class="form-inline" style="margin-left:5px; padding-left:8px; padding-top:3px; font-size:0.9em; height:60px; width:150px; border-radius: 5px; border: 1px solid #ddd;">
          <i class="fa fa-spinner fa-spin" ng-show="donorSummaryLoading"></i>
          <span class="center-block" ng-hide="donorSummaryLoading">
            {{donorSummary.firstName}} {{donorSummary.lastName}}
          </span>
          <span class="center-block" ng-switch="donorSummary.gender" ng-hide="donorSummaryLoading">
            <span ng-switch-when="male">
              <i class="fa fa-male"></i>
              Male
            </span>
            <span ng-switch-when="female">
              <i class="fa fa-female"></i>
              Female
            </span>
          </span>
          <span class="center-block" ng-hide="donorSummaryLoading">
            {{donorSummary.birthDate | bsisDate}}
          </span>
        </div>

      </div>
    </div>

    <div class="form-group">
      <label for="donationIdentificationNumber" class="col-sm-3 control-label">DIN</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <input name="din" size="15" type="donationIdentificationNumber" id="donationIdentificationNumber" class="form-control input-sm" placeholder="" ng-model="donation.donationIdentificationNumber"
          required integer ng-minlength=7 ng-maxlength=7
          ng-model-options="{ updateOn:'default blur', debounce: { default: 1000, blur: 0 } }"
          ng-class="{'ng-invalid ng-dirty' : (addDonationForm.din.$invalid && submitted) || err['donation.donationIdentificationNumber']}"
          >
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.din.$error.required && (addDonationForm.din.$dirty || submitted))
              ">
              This cannot be empty
            </small>
          </div>
          <div>
            <small class="error"
              ng-show="
                (!addDonationForm.din.$error.required && addDonationForm.din.$invalid && (addDonationForm.din.$dirty || submitted))
              ">
              Invalid input
            </small>
              <small class="error" ng-show="err['donation.donationIdentificationNumber']">
                  {{err["donation.donationIdentificationNumber"]}}
              </small>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="packType" class="col-sm-3 control-label">Pack</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <select name="packType" id="packType" class="form-control input-sm" ng-model="donation.packType" ng-options="item as item.packType for item in packTypes" required
          ng-class="{'ng-invalid ng-dirty' : addDonationForm.packType.$invalid && submitted}"
          >
              <option value=""></option>
          </select>
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.packType.$invalid && (addDonationForm.packType.$dirty || submitted))
              ">
              This cannot be empty
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="donationType" class="col-sm-3 control-label">Donation</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <select name="donationType" id="donationType" class="form-control input-sm" ng-model="donation.donationType" ng-options="item as item.donationType for item in donationTypes" required
          ng-class="{'ng-invalid ng-dirty' : addDonationForm.donationType.$invalid && submitted}"
          >
              <option value=""></option>
          </select>
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.donationType.$invalid && (addDonationForm.donationType.$dirty || submitted))
              ">
              This cannot be empty
            </small>
          </div>
        </div>
      </div>
    </div>

  </div>
    <div class="col-md-4">

    <p><em>Bleed Times</em></p>
    <hr style="margin-top:8px; margin-bottom:1px;"/>

    <div class="form-group">
      <label for="" class="col-sm-2 control-label" style="padding-top:30px;">Start</label>
      <div class="row col-sm-10">
        <div style="padding-left:5px;">
          <timepicker ng-model="bleedStartTime" name="bleedStartTime"  hour-step="hstep" minute-step="mstep"></timepicker>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="" class="col-sm-2 control-label" style="padding-top:30px;">End</label>
      <div class="row col-sm-10">
        <div style="padding-left:5px;">
          <timepicker ng-model="bleedEndTime" name="bleedEndTime" hour-step="hstep" minute-step="mstep"></timepicker>
        </div>
      </div>
    </div>

    <div>
      <small class="error"
        ng-show="
         addDonationForm.bleedStartTime.$error.time || addDonationForm.bleedEndTime.$error.time
        ">
        Invalid input
      </small>
    </div>

    <div>
      <small class="error"
        ng-show="
          (bleedEndTime < bleedStartTime) && !addDonationForm.bleedStartTime.$error.time && !addDonationForm.bleedEndTime.$error.time
        ">
        End time should be after Start time
      </small>
    </div>


  </div>
  <div class="col-md-4">

    <p><em>Donor Assessment</em></p>
    <hr style="margin-top:8px;"/>

    <div class="form-group">
      <label for="name" class="col-sm-3 control-label">Weight</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <input name="donorWeight" size="4" type="number" id="donorWeight" class="form-control input-sm" placeholder="" ng-model="donation.donorWeight"
          decimal min={{weightMin}} max={{weightMax}}
          ng-model-options="{ updateOn:'default blur', debounce: { default: 500, blur: 0 } }"
          ng-class="{'ng-invalid ng-dirty' :  (addDonationForm.donorWeight.$invalid && submitted) || err['donation.donorWeight']}"
          > <em> {{weightUnit}}  </em>
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.donorWeight.$invalid && (addDonationForm.donorWeight.$dirty || submitted))
              ">
              Invalid input
            </small>
            <small class="error" ng-show="err['donation.donorWeight']">
                {{err["donation.donorWeight"]}}
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group" >
      <label for="name" class="col-sm-3 control-label">Hb</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <input ng-show="getBooleanValue('donation.hbNumericValue')" name="hb" size="5" type="number" id="haemoglobinCount" class="form-control input-sm" placeholder="" ng-model="donation.haemoglobinCount"
          decimal min={{hbMin}} max={{hbMax}}
          ng-model-options="{ updateOn:'default blur', debounce: { default: 500, blur: 0 } }"
          ng-class="{'ng-invalid ng-dirty' : (addDonationForm.hb.$invalid && submitted) || err['donation.haemoglobinCount']}"
          > <em> {{hbUnit}} </em>
          <select ng-show="getBooleanValue('donation.hbQualitativeValue')" class="form-control input-sm" ng-model="donation.haemoglobinLevel" ng-options="l.value as l.label for l in haemoglobinLevels">
            <option value="" ng-disabled="true">Level</option>
          </select>
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.hb.$invalid && (addDonationForm.hb.$dirty || submitted))
              ">
              Invalid input
            </small>
            <small class="error" ng-show="err['donation.haemoglobinCount']">
                {{err["donation.haemoglobinCount"]}}
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="name" class="col-sm-3 control-label">BP</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <input name="bpSystolic" size="1" type="number" id="bloodPressureSystolic" class="form-control input-sm" placeholder="" ng-model="donation.bloodPressureSystolic"
          integer min={{bpSystolicMin}} max={{bpSystolicMax}}
          ng-model-options="{ updateOn:'default blur', debounce: { default: 500, blur: 0 } }"
          ng-class="{'ng-invalid ng-dirty' : (addDonationForm.bpSystolic.$invalid && submitted) || err['donation.bloodPressureSystolic']}"
          > /
          <input name="bpDiastolic" size="1" type="number" id="bloodPressureDiastolic" class="form-control input-sm" placeholder="" ng-model="donation.bloodPressureDiastolic"
          integer min={{bpDiastolicMin}} max={{bpDiastolicMax}}
          ng-model-options="{ updateOn:'default blur', debounce: { default: 500, blur: 0 } }"
          ng-class="{'ng-invalid ng-dirty' : (addDonationForm.bpDiastolic.$invalid && submitted) || err['donation.bloodPressureDiastolic']}"
          > <em> {{bpUnit}} </em>
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.bpSystolic.$invalid && (addDonationForm.bpSystolic.$dirty || submitted)) ||
                (addDonationForm.bpDiastolic.$invalid && (addDonationForm.bpDiastolic.$dirty || submitted))
              ">
              Invalid input
            </small>
            <small class="error" ng-show="err['donation.bloodPressureSystolic']">
                {{err["donation.bloodPressureSystolic"]}}
            </small>
            <small class="error" ng-show="err['donation.bloodPressureDiastolic']">
                {{err["donation.bloodPressureDiastolic"]}}
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="name" class="col-sm-3 control-label">Pulse</label>
      <div class="row col-sm-9">
        <div class="form-inline" style="padding-left:5px;">
          <input name="pulse" size="4" type="number" id="donorPulse" class="form-control input-sm" placeholder="" ng-model="donation.donorPulse"
          integer min={{pulseMin}} max={{pulseMax}}
          ng-model-options="{ updateOn:'default blur', debounce: { default: 500, blur: 0 } }"
          ng-class="{'ng-invalid ng-dirty' : (addDonationForm.pulse.$invalid && submitted) || err['donation.donorPulse'] }"
          > <em> {{pulseUnit}} </em>
          <div>
            <small class="error"
              ng-show="
                (addDonationForm.pulse.$invalid && (addDonationForm.pulse.$dirty || submitted))
              ">
              Invalid input
            </small>
            <small class="error" ng-show="err['donation.donorPulse']">
                {{err["donation.donorPulse"]}}
            </small>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="form-group">
    <div class="col-sm-offset-1 col-sm-11">
      <button class="btn btn-primary" type="submit">Save</button>
      <button class="btn btn-primary" type="button" ng-click="clearForm(addDonationForm); viewDonationBatch()"/>Cancel</button>
    </div>
  </div>



</form>
