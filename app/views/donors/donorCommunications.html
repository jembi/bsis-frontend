<h3 class="page-header">View / Export Donor List</h3>

<form name="donorCommunicationsForm" class="form-horizontal" role="form" ng-submit="onSearch(donorCommunicationsForm)" novalidate>

  <div ng-show="error.message">
    <alert type="danger" close="error.message = null">{{error.message}}</alert>
  </div>

  <div class="form-group" ng-class="{'has-error': donorCommunicationsForm.$submitted && search.donorPanels.length === 0}">
    <label class="col-sm-2 control-label">Donor Panels</label>
    <div class="col-sm-10" ng-if="donorPanels.length > 0">
      <ui-select multiple ng-model="search.donorPanels" style="max-width:470px;width:100%;">
        <ui-select-match placeholder="Select:">{{$item.name}}</ui-select-match>
        <ui-select-choices repeat="donorPanel in donorPanels track by donorPanel.id">
          {{donorPanel.name}}
        </ui-select-choices>
      </ui-select>

      <select name="donorPanels" ng-model="search.donorPanels" ng-show="false" multiple required></select>
      <ng-messages for="donorCommunicationsForm.donorPanels.$error" role="alert" ng-show="donorCommunicationsForm.$submitted || donorCommunicationsForm.donorPanels.$dirty">
        <ng-messages-include src="messages.html"></ng-messages-include>
      </ng-messages>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2">Blood Groups</label>
    <div class="col-sm-10" ng-if="bloodGroups.length > 0">
      <ui-select multiple ng-model="search.bloodGroups" style="display:inline-block;max-width:470px;width:100%;" on-select="onBloodGroupSelect();">
        <ui-select-match placeholder="Select:">{{$item}}</ui-select-match>
        <ui-select-choices repeat="bloodGroup in bloodGroups | filter:$select.search">
          {{bloodGroup}}
        </ui-select-choices>
      </ui-select>
      <div class="checkbox" style="display:inline-block;">
        <input id="anyBloodGroup" type="checkbox" ng-model="search.anyBloodGroup" ng-checked="search.anyBloodGroup" ng-change="onAnyBloodGroupChange();">
        <label for="anyBloodGroup">Any Blood Group</label>
      </div>
      <div class="checkbox" style="display:inline-block;">
        <input id="noBloodGroup" type="checkbox" ng-model="search.noBloodGroup" ng-checked="search.noBloodGroup">
        <label for="noBloodGroup">No Blood Group</label>
      </div>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2">Previous Donation</label>
    <div class="col-sm-10">
      <dateselect name="lastDonationFromDate"
          ng-class="{'has-error': donorCommunicationsForm.$submitted && donorCommunicationsForm.lastDonationFromDate.$invalid}"
          ng-model="search.lastDonationFromDate"
          ng-required="search.lastDonationToDate"
          format="dateFormat">
      </dateselect>
      <span>To:</span>
      <dateselect-end name="lastDonationToDate"
          ng-class="{'has-error': donorCommunicationsForm.$submitted && donorCommunicationsForm.lastDonationToDate.$invalid}"
          ng-model="search.lastDonationToDate"
          ng-required="search.lastDonationFromDate"
          format="dateFormat">
      </dateselect-end>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2">Due To Donate</label>
    <div class="col-sm-10">
      <dateselect name="clinicDate"
          ng-class="{'has-error': donorCommunicationsForm.$submitted && donorCommunicationsForm.clinicDate.$invalid}"
          ng-model="search.clinicDate"
          format="dateFormat">
      </dateselect>
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <button type="submit" class="btn btn-primary">Search</button>
      <button type="reset" class="btn btn-primary" ng-click="onClear(donorCommunicationsForm);">Clear</button>
    </div>
  </div>

</form>

<div class="panel panel-default" ng-if="currentSearch">
  <div class="panel-body">
    <p>
      <em>{{gridOptions.data.length}} donor(s) found</em>
    </p>
    <div class="grid" ui-grid="gridOptions" ui-grid-exporter ui-grid-pagination></div>
  </div>
</div>
