<div class="col-sm-3 col-md-2" ng-include="'views/donors/sidebar.html'"></div>
<div class="col-sm-9 col-md-10 main">
<span class="h2"> 
  <span>{{donor.firstName}}</span> 
  <span>{{donor.lastName}}</span>
  <small><em>
    <span ng-if="donor.title"> 
    <span>{{donor.title}}</span>.</span>
      <span>{{donor.callingName}}</span>
  </em></small>
</span>

<!-- Gender -->
<span ng-switch="donor.gender" class="h3" style="vertical-align: 0.3em; padding-left:10px;"> 
  <span ng-switch-when="male" class="fa-stack fa-1x">
    <i class="fa fa-circle fa-stack-2x fa-fw"></i>
    <i class="fa {{icons.MALE}} fa-stack-1x fa-inverse fa-fw"></i>
  </span>
  <span ng-switch-when="female" class="fa-stack fa-1x">
    <i class="fa fa-circle fa-stack-2x fa-fw"></i>
    <i class="fa {{icons.FEMALE}} fa-stack-1x fa-inverse fa-fw"></i>
  </span>
</span>

<!-- Blood group -->
<span class="h3" ng-if="donor.bloodGroup !== ''" style="vertical-align: 0.3em; padding-left:5px;">
  <span class="fa-stack fa-1x">
    <i class="fa fa-circle fa-stack-2x fa-fw"></i>
    <i class="fa fa-stack-1x fa-inverse">{{donor.bloodGroup}}</i>
  </span>
</span>

<hr/>

<!-- Details -->
<div class="h4">
    <small><em>Age: </em></small>
    <span calculate-age dob="{{donor.birthDate}}" age="age">{{age}}</span>
    <em>(<span>{{donor.birthDate | bsisDate}}</span>)</em>
    |
    <small><em>Donor Number: </em></small>
    {{donor.donorNumber}}
    |
    <small><em>Venue: </em></small>
    <span>{{donor.venue.name}}</span>
    |
    <small><em>Preferred Language: </em></small>
    <span>{{donor.preferredLanguage.preferredLanguage}}</span>
</div>

<hr/>

<!-- Counselling form -->
<div class="panel panel-default">
    <div class="panel-body">
        <form name="postDonationCounsellingForm" ng-submit="updatePostDonationCounselling()"
              novalidate>
          <div class="col-sm-12">
            <div class="row form-inline form-multiline">
              <div class="form-group">
                <label for="counsellingDate" style="width: 120px">Counselling Date:</label>
                <dateselect name="counsellingDate"
                            format="dateFormat"
                            ng-model="postDonationCounselling.counsellingDate"
                            required ng-class="{'has-error': postDonationCounsellingForm.$submitted && postDonationCounsellingForm.counsellingDate.$invalid}">
                </dateselect>
                <ng-messages role="alert"
                             for="postDonationCounsellingForm.counsellingDate.$error"
                             ng-show="postDonationCounsellingForm.$submitted || postDonationCounsellingForm.counsellingDate.$dirty">
                    <ng-messages-include src="messages.html"></ng-messages-include>
                </ng-messages>
              </div>
              <div class="form-group">
                <label for="counsellingStatus">Counselling Status:</label>
                <select class="form-control"
                        name="counsellingStatus"
                        ng-model="postDonationCounselling.counsellingStatus"
                        ng-options="counsellingStatus.label for counsellingStatus in counsellingStatuses track by counsellingStatus.id"
                        required ng-change="updateReferredEnabled()"
                        ng-class="{'has-error': postDonationCounsellingForm.$submitted && postDonationCounsellingForm.counsellingStatus.$invalid}">
                </select>
                <ng-messages role="alert"
                             for="postDonationCounsellingForm.counsellingStatus.$error"
                             ng-show="postDonationCounsellingForm.$submitted || postDonationCounsellingForm.counsellingStatus.$dirty">
                    <ng-messages-include src="messages.html"></ng-messages-include>
                </ng-messages>
              </div>
              <div class="form-group">
                <label for="referred">Referred</label>
                <input type="checkbox" id="referred" ng-click="updateReferralSites()" ng-model="postDonationCounselling.referred" ng-disabled="!referredEnabled">
                <label for="referralSite">To:</label>
                  <select name="referralSite" class="form-control" ng-disabled="!postDonationCounselling.referred" ng-model="postDonationCounselling.referralSite" ng-options="referralSite as referralSite.name for referralSite in referralSites" style="min-width: 150px;" ng-required="postDonationCounselling.referred">
                      <option value="" disabled></option>
                  </select>
                  <div>
                      <ng-messages for="postDonationCounsellingForm.referralSite.$error" role="alert" ng-show="postDonationCounsellingForm.$submitted">
                      <ng-messages-include src="messages.html"></ng-messages-include>
                  </div>
              </div>
              <div class="form-group">
                  <label for="counsellingNotes" style="width: 120px">Counselling Notes:</label>
                  <input name="counsellingNotes" type="text" class="form-control" style="width: 600px;" ng-model="postDonationCounselling.notes"/>
              </div>
              <div class="form-group">
                  <button type="submit" class="btn btn-primary" style="margin-top:0;" ng-disabled="updatingCounselling">
                      {{updatingCounselling ? "Saving..." : "Save"}}
                  </button>
                  <a class="btn btn-primary" style="margin-top:0;" href="" ng-click="goBack()"
                     ng-disabled="updatingCounselling">Cancel</a>
                  <a class="btn btn-primary" style="margin-top:0;" href="" ng-click="removeStatus()"
                     ng-disabled="!postDonationCounselling.permissions.canRemoveStatus || updatingCounselling">Remove
                      Status</a>
              </div>
            </div>
          </div>
        </form>
    </div>
</div>

<!-- Donation details -->
<div class="panel panel-default">
    <div class="panel-body" ng-include="'views/donors/donationDetails.html'"></div>
</div>
</div>
