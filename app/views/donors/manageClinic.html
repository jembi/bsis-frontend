<form editable-form name="editableForm" onaftersave="updateDonationBatch(donationBatch, confirmReopen); confirmReopen = false; confirmEdit = false">
  <span class="h3"> 
    Manage Donation Batch
  </span> 

{{message}}
  <hr/>

  <div class = "h4"> 
    <small><em>Date Created: </em></small> <span ng-show="!editableForm.$visible">{{ (donationBatch.createdDate | bsisDate) || '' }}</span>
    <span ng-show="editableForm.$visible">
      <dateselect ng-model="donationBatch.createdDate" initDate="donationBatch.createdDate" format="format" cal-icon="icons.CALENDAR" opened="dateToOpen"></dateselect>
    </span>
    | 
    <small><em>Venue: </em></small> <span e-class="xeditable venue" editable-select="donationBatch.venue" e-ng-options="item as item.name for item in venues track by item.name" e-name="venue"  e-required>{{donationBatch.venue.name}}</span>
    |
    <small><em>Number of Donations: </em></small> {{donationBatch.numDonations}}


    <span style="float: right; padding-right: 15px;">

      <!-- Delete donor actions -->
      <div has-permission="{{permissions.VOID_DONATION_BATCH}}" ng-hide="confirmClose || confirmReopen || confirmEdit" style="display:inline;">
        <em><a href="" type="button" class="btn btn-link" ng-click="confirmDelete = true" ng-hide="confirmDelete" ng-disabled="!donationBatch.permissions.canDelete">Void</a></em>
        <span ng-show="confirmDelete">
          <em>
            <a href="" type="button" class="btn btn-link text-danger" ng-click="deleteDonationBatch(donationBatch.id); confirmDelete = false">Void</a>
            <a href="" type="button" class="btn btn-link text-muted" ng-click="confirmDelete = false">Cancel</a>
          </em>
        </span>
      </div>

      <!-- Edit donor actions -->
      <div has-permission="{{permissions.EDIT_DONATION_BATCH}}" ng-hide="confirmDelete || confirmClose || confirmReopen" style="display:inline;">
        <em><a href="" type="button" class="btn btn-link" ng-click="editableForm.$show(); confirmEdit = true" ng-hide="confirmEdit">Edit</a></em>
        <span ng-show="confirmEdit">
          <em>
            <button type="submit" class="btn btn-link text-success" ng-disabled="editableForm.$waiting">Save</button>
            <a href="" type="button" class="btn btn-link text-muted" ng-disabled="editableForm.$waiting" ng-click="editableForm.$cancel(); confirmEdit = false;">Cancel</a>
          </em>
        </span>
      </div>

      <!-- Close batch actions -->
      <div has-permission="{{permissions.EDIT_DONATION_BATCH}}" ng-hide="donationBatch.isClosed === true || confirmDelete || confirmEdit" style="display:inline;">
        <em><a href="" type="button" class="btn btn-link" ng-click="confirmClose = true" ng-hide="confirmClose" ng-disabled="!donationBatch.permissions.canClose">Close Batch</a></em>
        <span ng-show="confirmClose">
          <em>
            <a href="" type="submit" class="btn btn-link text-success" ng-click="closeDonationBatch(donationBatch); confirmClose = false">Save</a>
            <a href="" type="button" class="btn btn-link text-muted" ng-click="confirmClose = false">Cancel</a>
          </em>
        </span>
      </div>

      <!-- Reopen batch actions -->
      <div has-permission="{{permissions.EDIT_DONATION_BATCH}}" ng-hide="donationBatch.isClosed === false || confirmDelete || confirmEdit" style="display:inline;">
        <em><a href="" type="button" class="btn btn-link" ng-click="editableForm.$show(); confirmReopen = true" ng-hide="confirmReopen" ng-disabled="!donationBatch.permissions.canReopen">Reopen Batch</a></em>
        <span ng-show="confirmReopen">
          <em>
            <button type="submit" class="btn btn-link text-success" ng-disabled="editableForm.$waiting">Save</button>
            <a href="" type="button" class="btn btn-link text-muted" ng-disabled="editableForm.$waiting" ng-click="editableForm.$cancel(); confirmReopen = false">Cancel</a>
          </em>
        </span>
      </div>
    </span>

  </div>
</form>

  <hr/>

  <div style="padding-bottom: 5px"></div>

  <div class="col-sm-12">

    <div class="panel panel-default">
      <div class="panel-body">
        <div ng-switch on="donationBatchView">
            <div ng-switch-when="viewDonationBatch"><div ng-include="'views/donors/viewDonationBatch.html'"></div></div>
            <div ng-switch-when="addDonation"><div ng-include="'views/donors/addDonation.html'"></div></div>
            <div ng-switch-when="viewDonationSummary"><div ng-include="'views/donors/viewDonationSummary.html'"></div></div>
            <div ng-switch-default><div ng-include="'views/donors/viewDonationBatch.html'"></div></div>
          </div>
      </div>
    </div>
  </div>
