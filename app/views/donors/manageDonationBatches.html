<span class="h3 page-header">Manage Donation Batches</span>

<hr/>
<div class="col-sm-12">

    <tabset justified="true">
        <tab>
            <tab-heading>
                <i class="fa {{icons.BARS}}"></i> Open Batches
            </tab-heading>
            <div ng-switch="openDonationBatches" class="col-sm-12">
                <div style="padding-bottom: 10px"></div>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div ng-switch-when="true">
                            <table ng-table="donationBatchTableParams" show-filter="false" class="table">
                                <tr ng-repeat="donationBatch in $data"
                                    ng-click="manageClinic(donationBatch);"
                                    ng-mouseenter="this.$selected = true"
                                    ng-mouseleave="this.$selected = false"
                                    ng-class="{'active': donationBatch.$selected}">
                                    <td data-title="'Created'" style="width:15%;" header-class="text-left"
                                        sortable="'date'">
                                        {{donationBatch.createdDate | bsisDate}}
                                    </td>
                                    <td data-title="'Venue'" style="width:25%;" header-class="text-left"
                                        sortable="'center'">
                                        {{donationBatch.venue.name}}
                                    </td>
                                    <td data-title="'# of Donations'" style="width:20%;" header-class="text-left"
                                        class="text-center" sortable="'numDonations'">
                                        {{donationBatch.numDonations}}
                                    </td>
                                    <td data-title="'Historical'" style="width:15%;" header-class="text-left"
                                        class="text-center" sortable="'backEntry'">
                                        <span ng-show="donationBatch.backEntry"><i class="fa {{icons.SQUARECHECK}}"></i></span>
                                        <span ng-show="!donationBatch.backEntry"><i
                                                class="fa {{icons.SQUARE}}"></i></span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div ng-switch-when="false">
                            <p>
                                <em> No open donation batches. </em>
                            </p>
                        </div>

                        <div has-permission="{{permissions.ADD_DONATION_BATCH}}">
                            <h4>New Donation Batch</h4>
                            <form name="addDonationBatchForm" novalidate class="form-horizontal col-sm-12" role="form"
                                  ng-submit="addDonationBatch(newDonationBatch, addDonationBatchForm)">
                                <div class="form-group">
                                    <label for="name" class="col-sm-1 control-label">Venue</label>
                                    <div class="row col-sm-11">
                                        <div class="form-inline" style="padding-left:5px;">
                                            <select name="venue" class="form-control input-sm"
                                                    ng-model="newDonationBatch.venue"
                                                    ng-options="item.id as item.name disable when (item.disabled || item.isDeleted) for item in venues"
                                                    required
                                                    ng-class="{'ng-invalid ng-dirty' : addDonationBatchForm.venue.$invalid && submitted}">
                                                <option value="" ng-disabled="true"></option>
                                            </select>
                                            <div>
                                                <small class="error"
                                                       ng-show="
                            (addDonationBatchForm.venue.$invalid && (addDonationBatchForm.venue.$dirty || submitted))
                          ">
                                                    This cannot be empty
                                                </small>
                                                <small class="error" ng-show="err['donationBatch.venue']">
                                                    {{err["donationBatch.venue"]}}
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-1 col-sm-11">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" ng-model="newDonationBatch.backEntry"> Historical
                                                Data Entry
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-1 col-sm-4">
                                        <button class="btn btn-primary" type="submit" ng-disabled="addingDonationBatch">
                                            {{addingDonationBatch ? "Adding..." : "Add Donation Batch"}}
                                        </button>
                                        <button class="btn btn-primary" type="button" ng-click="clear()">Clear</button>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
        </tab>

        <tab>
            <tab-heading>
                <i class="fa {{icons.ARCHIVE}}"></i> Closed Batches
            </tab-heading>
            <form class="form-horizontal" role="form"  name="recentDonationsForm" style="padding:10px 0;" ng-submit="getRecentDonationBatches(recentDonationsForm)" novalidate>
                <div class="clearfix form-group">
                    <label class="col-sm-2 control-label">Venues:</label>
                    <div class="col-sm-10 ">
                        <ui-select name="selectedVenues" multiple ng-model="search.selectedVenues" style="max-width:500px;min-height:34px;" ui-select-required
                                   ng-if="venues.length > 0">
                            <ui-select-match placeholder="Select:">{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="venue.id as venue in venues | filter:$select.search">
                                {{venue.name}}
                            </ui-select-choices>
                        </ui-select>
                        <small class="error" ng-show="(recentDonationsForm.$submitted && recentDonationsForm.$error.uiSelectRequired)">
                            This cannot be empty
                        </small>
                    </div>
                </div>
                <div class="clearfix form-group">
                    <label class="col-sm-2 control-label">Batch Date:</label>
                    <div class="form-inline col-sm-10">
                        <div>
                            <dateselect name="startDate" ng-model="search.startDate" format="dateFormat" ng-class="{'has-error' : (recentDonationsForm.startDate.$invalid)}" ng-required="true" ui-date-range="1,months" ui-date-end="{{search.endDate | date:'yyyy-MM-dd HH:mm:ss'}}" ng-model-options="{ allowInvalid: true }"></dateselect>
                            <span><em>To:</em></span>
                            <dateselect-end name="endDate" ng-model="search.endDate" format="dateFormat" ng-class="{'has-error' : (recentDonationsForm.endDate.$invalid)}" ng-required="true" ui-date-range="1,months" ui-date-start="{{search.startDate |  date:'yyyy-MM-dd HH:mm:ss'}}" ng-model-options="{ allowInvalid: true }"></dateselect-end>
                        </div>
                        <div>
                            <small class="error" ng-show="(recentDonationsForm.startDate.$error.required || recentDonationsForm.endDate.$error.required)">
                                Select a valid date
                            </small>
                            <small class="error" ng-show="(recentDonationsForm.startDate.$error.uiDateRange || recentDonationsForm.endDate.$error.uiDateRange)">
                                Select a date range that is less than one month
                            </small>
                        </div>
                    </div>
                </div>

                <div class="col-sm-offset-2 ">
                    <button class="btn btn-primary" type="submit" ng-disabled="searching">{{searching ? "Searching..." :
                        "Search"}}
                    </button>
                    <button class="btn btn-primary" type="reset" ng-click="clearSearch(recentDonationsForm)">Clear</button>
                </div>
            </form>

            <div ng-switch="recentDonationBatches" class="col-sm-12">
                <div ng-switch-when="true">
                    <div style="padding-bottom: 10px"></div>
                    <div class="panel panel-default">
                        <div class="panel-body">

                            <table ng-table="recentDonationBatchesTableParams" show-filter="false" class="table">
                                <tr ng-repeat="donationBatch in $data"
                                    ng-click="manageClinic(donationBatch);"
                                    ng-mouseenter="this.$selected = true"
                                    ng-mouseleave="this.$selected = false"
                                    ng-class="{'active': donationBatch.$selected}">
                                    <td data-title="'Created'" style="width:20%;" header-class="text-left"
                                        sortable="'date'">
                                        {{donationBatch.createdDate | bsisDate}}
                                    </td>
                                    <td data-title="'Closed'" style="width:30%;" header-class="text-left"
                                        sortable="'date'">
                                        {{donationBatch.lastUpdated | bsisDateTime }}
                                    </td>
                                    <td data-title="'Venue'" style="width:25%;" header-class="text-left"
                                        sortable="'center'">
                                        {{donationBatch.venue.name}}
                                    </td>
                                    <td data-title="'# of Donations'" style="width:25%;" header-class="text-left"
                                        class="text-center" sortable="'numDonations'">
                                        {{donationBatch.numDonations}}
                                    </td>
                                    <td data-title="'Historical'" style="width:15%;" header-class="text-left"
                                        class="text-center" sortable="'backEntry'">
                                        <span ng-show="donationBatch.backEntry"><i class="fa {{icons.SQUARECHECK}}"></i></span>
                                        <span ng-show="!donationBatch.backEntry"><i
                                                class="fa {{icons.SQUARE}}"></i></span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div ng-switch-when="false">
                    <div class="panel panel-default" ng-if="recentDonationBatchData">
                        <div class="panel-body">
                            <p>
                                <em> No closed donation batches. </em>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </tab>

    </tabset>



