<form editable-form name="editableForm" onaftersave="updateDonor(donor)">

  <span class="h2"> 
    <span editable-text="donor.firstName" e-name="firstName" e-class="xeditable name" e-required>{{donor.firstName}}</span> 
    <span editable-text="donor.lastName" e-name="lastName" e-class="xeditable name" e-required>{{donor.lastName}}</span><small><em>
    <span ng-if="donor.title"> 
    <span editable-select="donor.title" e-class="xeditable title" e-ng-options="item as item for item in title" e-name="title" >{{donor.title}}</span>.</span>
    <span editable-text="donor.callingName" e-name="callingName" e-class="xeditable name">{{donor.callingName}}</span>
    </em></small>
  </span>

    <span ng-switch="donor.gender" class="h3" style="vertical-align: 0.3em; padding-left:10px;"> 
      <span ng-switch-when="male" class="fa-stack fa-1x">
        <i class="fa fa-circle fa-stack-2x fa-fw"></i>
        <i class="fa {{icons.MALE}} fa-stack-1x fa-inverse fa-fw"></i>
      </span>
      <span ng-switch-when="female" class="fa-stack fa-1x">
        <i class="fa fa-circle fa-stack-2x fa-fw"></i>
        <i class="fa {{icons.FEMALE}} fa-stack-1x fa-inverse fa-fw"></i>
      </span>
    </span>
    <span class="h3" ng-if="donor.bloodGroup !== ''" style="vertical-align: 0.3em; padding-left:5px;">
      <span class="fa-stack fa-1x">
        <i class="fa fa-circle fa-stack-2x fa-fw"></i>
        <i class="fa fa-stack-1x fa-inverse">{{donor.bloodGroup}}</i>
      </span>
    </span>

    <span class="h4" style="float: right; margin-top: 20px; padding-right: 15px;">
      <small><em><a has-permission="{{permissions.EDIT_DONOR}}" href="" ng-click="editableForm.$show()" ng-show="!editableForm.$visible">Edit Donor</a></em>  
      <span ng-show="!editableForm.$visible">
      </span>


    <span ng-show="editableForm.$visible">
      <em>
      <button type="submit" class="btn" style="background:none!important; border:none;  cursor: pointer;" ng-disabled="editableForm.$waiting">
        Save
      </button>
      <button type="button" class="btn" style="background:none!important; border:none;  cursor: pointer;" ng-disabled="editableForm.$waiting" ng-click="editableForm.$cancel()">
        Cancel
      </button>
      </em>
    </span>

    <span has-permission="{{permissions.VOID_DONOR}}">  |  <em><a ng-show="!editableForm.$visible" href="">Void Donor</a></em></small> </span>
    </span>

  <hr/>

  <div class = "h4"> 
    <small><em>Age: </em></small>
    <span calculate-age dob="{{donor.birthDate}}" age="age">{{age}}</span>
    <em>(<span ng-show="!editableForm.$visible">{{ (donor.birthDate | date:"dd/MM/yyyy") || '' }}</span> 
        <span ng-show="editableForm.$visible">
          <dateselect ng-model="birthDate" initDate="donor.birthDate" date-options="dateOptions" format="format" opened="donorBirthDateOpen" cal-icon="icons.CALENDAR">
          </dateselect>
        </span>) </em>
    | 
    <small><em>Donor Number: </em></small> {{donor.donorNumber}}
    | 
    <small><em>Donor Panel: </em></small> 
    <span editable-select="donor.donorPanel.id" e-class="xeditable donor-panel" e-ng-options="item.id as item.name for item in donorPanels" e-name="donorPanel"  e-required>
      {{donor.donorPanel.name}}
    </span>
    | 
    <small><em>Preferred Language: </em></small> 
    <span editable-select="donor.preferredLanguage.id" e-ng-options="item.id as item.preferredLanguage for item in languages" e-class="xeditable language" e-name="preferredLanguage">
      {{donor.preferredLanguage.preferredLanguage}}
    </span>

    <span style="float: right; padding-right: 15px;">
      <small>
      <em>
      <a href="" ng-click="printDonorBarcode()" >Print Donor Barcode</a>
      </em>
      </small>
    </span>
  </div>

</form>

<hr/>

<div style="padding-bottom: 5px"></div>

<div class="col-sm-12">

  <tabset justified="true" >
    <tab>
      <tab-heading>
        <i class="fa {{icons.INFOCIRCLE}}"></i> Overview
      </tab-heading>

      <div class="panel panel-default">
        <div class="panel-body">

          <table class="dash-table">
            <tbody>
              <tr>
                <td class="icon"><i class="fa {{icons.CALENDAR}}"></i></td>
                <td class="field">Due To Donate: </td>
                <td class="value green"></td>
              </tr>
              <tr>
                <td class="icon"><i class="fa {{icons.WARNING}}"></i></td>
                <td class="field">Currently Deferred: </td>
                <td ng-if="currentlyDeferred" class="value red"> Deferred until {{deferredUntil}}</td>
                <td ng-if="!currentlyDeferred" class="value green"> No current deferrals</td>
              </tr>
              </tr>
              <tr><td></td></tr>
              <tr>
                <td class="icon"><i class="fa {{icons.PLUS}}"></i></td>
                <td class="field">Total Donations: </td>
                <td class="value">{{totalDonations}}</td>
              </tr>
              <tr ng-show="totalDonations > 0">
                <td class="icon"><i class="fa {{icons.CIRCLEO}}"></i></td>
                <td class="field">Date of First Donation: </td>
                <td class="value">{{dateOfFirstDonation | date:'longDate'}}</td>
              </tr>
              <tr ng-show="totalDonations > 0">
                <td class="icon"><i class="fa {{icons.CIRCLE}}"></i></td>
                <td class="field">Previous Donation: </td>
                <td class="value"><em>Date</em>: {{ (lastDonation.collectedOn | date:"dd/MM/yyyy") || '' }}<br/>
                    <em>Panel</em>: {{lastDonation.donorPanel.name}} <br/>
                    <em>Donation Type</em>: {{lastDonation.donationType.donationType}} | <em>Pack Type</em>: {{lastDonation.packType.bloodBagType}}<br/>
                    <em>Wt</em>: {{lastDonation.donorWeight}}kg | <em>BP</em>: {{lastDonation.bloodPressureDiastolic}}/{{lastDonation.bloodPressureSystolic}} |
                    <em>Hb</em>: {{lastDonation.haemoglobinCount}} | <em>P</em>: {{lastDonation.donorPulse}} </td>
              </tr>
              <tr><td></td></tr>

              <tr>
                <td class="icon"><i class="fa {{icons.INFO}}"></i></td>
                <td class="field">Identifier: </td>
                <td class="value">
                  <form editable-form name="donorIdentifierForm" onaftersave="updateDonor(donor)">
                    <span style="float: right; padding-right: 15px; padding-left: 15px; font-size: 0.9em">
                      <em><a has-permission="{{permissions.EDIT_DONOR}}" href="" ng-click="donorIdentifierForm.$show()" ng-show="!donorIdentifierForm.$visible">Edit</a></em>
                      <span ng-show="donorIdentifierForm.$visible">
                        <em>
                        <button type="submit" class="btn" style="background:none!important; border:none;  cursor: pointer;" ng-disabled="donorIdentifierForm.$waiting">
                          Save
                        </button>
                        <button type="button" class="btn" style="background:none!important; border:none;  cursor: pointer;" ng-disabled="donorIdentifierForm.$waiting" ng-click="donorIdentifierForm.$cancel()">
                          Cancel
                        </button>
                        </em>
                      </span>
                    </span>
                    <span e-class="xeditable" editable-text="donor.idNumber" e-name="idNumber">{{donor.idNumber}}</span> 
                    <em>
                    <span ng-if="donor.idType.id">(</span>
                    <span e-class="xeditable" editable-select="donor.idType.id" e-ng-options="item.id as item.idType for item in idTypes" e-name="idType">
                      {{donor.idType.idType}}
                    </span>
                    <span ng-if="donor.idType.id">)</span>
                    </em>
                  </form>
                </td>
              </tr>

              <tr><td></td></tr>


              <tr>
                <td class="icon"><i class="fa {{icons.COMMENT}}"></i></td>
                <td class="field">Comments: </td>
                <td class="value">
                  <form editable-form name="donorNotesForm" onaftersave="updateDonor(donor)">
                    <span style="float: right; padding-right: 15px; padding-left: 15px; font-size: 0.9em">
                      <em><a has-permission="{{permissions.EDIT_DONOR}}" href="" ng-click="donorNotesForm.$show()" ng-show="!donorNotesForm.$visible">Edit</a></em>
                      <span ng-show="donorNotesForm.$visible">
                        <em>
                        <button type="submit" class="btn" style="background:none!important; border:none;  cursor: pointer;" ng-disabled="donorNotesForm.$waiting">
                          Save
                        </button>
                        <button type="button" class="btn" style="background:none!important; border:none;  cursor: pointer;" ng-disabled="donorNotesForm.$waiting" ng-click="donorNotesForm.$cancel()">
                          Cancel
                        </button>
                        </em>
                      </span>
                    </span>
                    <span style="white-space: pre;" e-class="xeditable notes" editable-textarea="donor.notes" e-escape="true" e-rows="4" e-name="notes">{{donor.notes}}</span>
                  </form>
                </td>
              </tr>
            </tbody>
          </table>

        </div>
      </div>

    </tab>
    <tab>
      <tab-heading>
        <i class="fa {{icons.BARS}}"></i> Demographics
      </tab-heading>

      <div class="panel panel-default">
        <div class="panel-body">
          <div ng-include="'views/donors/viewDonorDemographics.html'"></div>
        </div>
      </div>

    </tab>

    <tab select="getDonations(donor.id)" has-permission="{{permissions.VIEW_DONATION}}">
      <tab-heading>
        <i class="fa {{icons.ARCHIVE}}"></i> Donations
      </tab-heading>
      
      <div class="panel panel-default">
        <div class="panel-body">

          <div ng-switch on="donationsView">
            <div ng-switch-when="viewDonations"><div ng-include="'views/donors/viewDonations.html'"></div></div>
            <div ng-switch-when="viewDonationDetails"><div ng-include="'views/donors/viewDonationDetails.html'"></div></div>
            <div ng-switch-default><div ng-include="'views/donors/viewDonations.html'"></div></div>
          </div>

        </div>
      </div>
    </tab>

    <tab select="getDeferrals(donor.id)" has-permission="{{permissions.VIEW_DEFERRAL}}">
      <tab-heading>
        <i class="fa {{icons.WARNING}}"></i> Deferrals
      </tab-heading>
      <div class="panel panel-default">
        <div class="panel-body">

        <div ng-switch on="deferralView">
          <div ng-switch-when="viewDeferrals"><div ng-include="'views/donors/viewDeferrals.html'"></div></div>
          <div ng-switch-when="manageDeferral"><div ng-include="'views/donors/manageDeferral.html'"></div></div>
          <div ng-switch-default><div ng-include="'views/donors/viewDeferrals.html'"></div></div>
        </div>

        </div>
      </div>

    </tab>
  </tabset>
  
</div>