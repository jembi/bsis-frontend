<span class="h3 page-header">Resolve Ambiguous ABO/Rh Outcomes</span>

<hr/>

<div class="h4">
    <small><em>Created On: </em></small>
    {{testBatch.createdDate | bsisDateTime}}
    |
    <small><em>Number of Samples: </em></small>
    {{testBatch.numSamples}}
</div>

<hr/>

<div style="padding-bottom: 5px"></div>

<div class="col-sm-12">
    <div class="panel panel-default">
        <div class="panel-body">
            <form ng-submit="saveBloodGroupMatchTestResults(addTestMatchResults)">
                <table ng-table="testSamplesTTITableParams" show-filter="false" class="table">
                    <thead>
                    <th class="text-left sortable"
                        ng-class="{
                          'sort-asc': testSamplesTTITableParams.isSortBy('donation.donationIdentificationNumber', 'asc'),
                          'sort-desc': testSamplesTTITableParams.isSortBy('donation.donationIdentificationNumber', 'desc')
                        }"
                        ng-click="testSamplesTTITableParams.sorting('donation.donationIdentificationNumber', testSamplesTTITableParams.isSortBy('donation.donationIdentificationNumber', 'asc') ? 'desc' : 'asc')">
                        <div>DIN <span ng-bind="$column.title(this)" ng-class="{'sort-indicator': params.settings().sortingIndicator=='span'}" class="ng-binding sort-indicator"></span></div>
                    </th>
                    <th class="text-center sortable"
                        ng-class="{
                          'sort-asc': testSamplesTTITableParams.isSortBy('donation.donationDate', 'asc'),
                          'sort-desc': testSamplesTTITableParams.isSortBy('donation.donationDate', 'desc')
                        }"
                        ng-click="testSamplesTTITableParams.sorting('donation.donationDate', testSamplesTTITableParams.isSortBy('donation.donationDate', 'asc') ? 'desc' : 'asc')">
                        <div>Donation Date <span ng-bind="$column.title(this)" ng-class="{'sort-indicator': params.settings().sortingIndicator=='span'}" class="ng-binding sort-indicator"></span></div>
                    </th>
                    <th class="text-center sortable" style="width:25%;"
                        ng-class="{
                          'sort-asc': testSamplesTTITableParams.isSortBy('donation.bloodTypingStatus', 'asc'),
                          'sort-desc': testSamplesTTITableParams.isSortBy('donation.bloodTypingStatus', 'desc')
                        }"
                        ng-click="testSamplesTTITableParams.sorting('donation.bloodTypingStatus', testSamplesTTITableParams.isSortBy('donation.bloodTypingStatus', 'asc') ? 'desc' : 'asc')">
                        <div>Blood Typing Status <span ng-bind="$column.title(this)" ng-class="{'sort-indicator': params.settings().sortingIndicator=='span'}" class="ng-binding sort-indicator"></span></div>
                    </th>
                    <th class="text-center sortable">
                        <div>Blood ABO</div>
                    </th>
                    <th class="text-center sortable">
                        <div>Blood Rh</div>
                    </th>
                    <th class="text-center sortable">
                        <div>Confirm</div>
                    </th>
                    </thead>
                    <tbody>
                    <tr ng-repeat="sample in $data"
                        ng-show="sample.bloodTypingStatus === 'COMPLETE' && sample.bloodTypingMatchStatus === 'AMBIGUOUS'"
                        ng-click=""
                        ng-mouseenter="this.$selected = true"
                        ng-mouseleave="this.$selected = false"
                        ng-class="{'active': sample.$selected}">
                        <td class="text-center"
                            ng-init="addTestMatchResults[sample.donation.donationIdentificationNumber].donationIdentificationNumber = sample.donation.donationIdentificationNumber">
                            {{sample.donation.donationIdentificationNumber}}
                        </td>
                        <td class="text-center">
                            {{sample.donation.donationDate | bsisDate}}
                        </td>
                        <td>
                            {{sample.bloodTypingMatchStatus}}
                        </td>
                        <td>
                            <div style="width:90px;">
                                <ui-select
                                        ng-init="addTestMatchResults[sample.donation.donationIdentificationNumber].bloodAbo = sample.bloodAbo"
                                        ng-model="addTestMatchResults[sample.donation.donationIdentificationNumber].bloodAbo"
                                        ng-disabled="disabled">
                                    <ui-select-match placeholder="">{{$select.selected}}</ui-select-match>
                                    <ui-select-choices
                                            repeat="result in bloodAboOptions.options  | filter: {$: $select.search}">
                                        <div ng-bind-html="result | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </td>
                        <td>
                            <div style="width:90px;">
                                <ui-select
                                        ng-init="addTestMatchResults[sample.donation.donationIdentificationNumber].bloodRh = sample.bloodRh"
                                        ng-model="addTestMatchResults[sample.donation.donationIdentificationNumber].bloodRh"
                                        ng-disabled="disabled">
                                    <ui-select-match placeholder="">{{$select.selected}}</ui-select-match>
                                    <ui-select-choices
                                            repeat="result in bloodRhOptions.options  | filter: {$: $select.search}">
                                        <div ng-bind-html="result | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </td>
                        <td align="center">
                            <input type="checkbox"
                                   ng-init="addTestMatchResults[sample.donation.donationIdentificationNumber].confirm = false"
                                   ng-model="addTestMatchResults[sample.donation.donationIdentificationNumber].confirm"/>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="form-group">
                    <div class="col-sm-3">
                        <button class="btn btn-primary" type="submit">Save Test Outcomes</button>
                        <button class="btn btn-primary" type="button" ng-click="go('/viewTestBatch')">Cancel</button>
                    </div>
                </div>

            </form>

        </div>
    </div>
</div>

