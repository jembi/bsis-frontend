<span class="h3 page-header">Manage Test Batch</span>

<span ng-if="testBatch.status == 'Complete'" class="h4" style="float: right; margin-top: 5px; margin-bottom: 5px; padding-right: 15px;">
  <em><a href="" ng-click="releaseTestBatch()">Release Batch</a> </em>|<em> <a href="" ng-click="closeTestBatch()">Close Batch</a></em></small>
</span>

<span class="h4" style="float: right; margin-top: 5px; padding-right: 15px;">
  <span has-permission="{{permissions.ADD_TTI_OUTCOME}}"> <small><em><a href="" ng-click="recordTestResults(testBatch, 'tti')" >Record TTI Test Results</a></em></small> </span>
  <span has-permissions="{{permissions.ADD_TTI_OUTCOME}};{{permissions.ADD_BLOOD_TYPING_OUTCOME}}"> | </span>
  <span has-permission="{{permissions.ADD_BLOOD_TYPING_OUTCOME}}"> <small><em><a href="" ng-click="recordTestResults(testBatch, 'bloodGrouping')" >Record Blood Group Serology Results</a></em></small> </span>

  <span ng-if="!pendingBloodTypingTests && !pendingTTITests 
    && basicBloodTypingComplete && basicTTIComplete
    && !pendingBloodTypingMatchTests">

    | 

    <small>
    <span ng-if="testBatchToClose == testBatch.id">
      <em><a href="" ng-click="closeTestBatch(testBatch)"> Confirm</a></em> | 
      <em><a href="" ng-click="closeTestBatchCancel()"> Cancel</a></em>
    </span>
    <span ng-if="testBatchToClose != testBatch.id">
      <em><a href="" ng-click="closeTestBatchCheck(testBatch)">Close Batch</a></em>
    </span>
    </small>
  </span>
</span>


<hr/>

<span class="h4" style="float: right; margin-top: 0px; margin-bottom: 0px; padding-right: 15px;">
  <span has-permissions="{{permissions.ADD_TTI_OUTCOME}};{{permissions.ADD_BLOOD_TYPING_OUTCOME}}" ng-if="pendingBloodTypingTests || pendingTTITests"> <small><em><a href="" ng-click="recordPendingTestResults(testBatch)" >Record Confirmatory Test Results</a></em></small> </span>
  <span ng-if="(pendingBloodTypingTests || pendingTTITests) && pendingBloodTypingMatchTests"> | </span>
  <span has-permission="{{permissions.ADD_BLOOD_TYPING_OUTCOME}}" ng-if="pendingBloodTypingMatchTests"> <small><em><a href="" ng-click="recordPendingBloodGroupMatchTests(testBatch)" >Record Confirmatory Abo/Rh Results</a></em></small> </span>
</span>

<div class="h4"> 
  <small><em>Created On: </em></small>{{testBatch.createdDate | bsisDate}}
  | 
  <small><em>Number of Samples: </em></small>{{testBatch.numSamples}}
</div>



<hr style="margin-bottom:5px;"/>
<span class="h4" style="font-size: 0.95em; margin-top:0px; margin-bottom:0px;" ng-repeat="donationBatch in testBatch.collectionBatches"> 
  <small><em>Center: </em></small>{{donationBatch.donorPanel.name}} | <small><em>Date: </em></small> {{donationBatch.createdDate}} | <small><em>Number of Donations: </em></small> {{donationBatch.numCollections}} 
  <br/>
</span>
<hr style="margin-top:5px;"/>

<div style="padding-bottom: 5px"></div>

<div class="col-sm-12">
  <div class="panel panel-default">
    <div class="panel-body">
      <table ng-table="testSamplesTableParams" show-filter="false" class="table">
        <tr ng-repeat="sample in $data"
            ng-click=""
            ng-mouseenter="this.$selected = true"
            ng-mouseleave="this.$selected = false"
            ng-class="{'active': sample.$selected}">
            <td data-title="'DIN'" header-class="text-left" class="text-center" sortable="'donationIdentificationNumber'">
                {{sample.collectionNumber}}
            </td>
            <td data-title="'Date Bled'" header-class="text-left" class="text-center" sortable="'collectedOn'">
                {{sample.collectedOn | bsisDate}}
            </td>
            <td data-title="'Pack'" header-class="text-left" sortable="'bloodBagType'">
                {{sample.packType.bloodBagType}}
            </td>
            <td data-title="'Clinic'" header-class="text-left" sortable="'center'">
                {{sample.donorPanel.name}}
            </td>
            <td data-title="'TTI Testing'" header-class="text-left" sortable="'ttiStatus'">
                {{sample.ttistatus}}
            </td>
            <td data-title="'Blood Group Serology'" header-class="text-left" sortable="'bloodTypingStatus'">
                <span ng-if="sample.bloodTypingStatus!= 'NOT_DONE'">{{sample.bloodTypingStatus}} - </span>{{sample.bloodTypingMatchStatus}} <em><span ng-if="sample.bloodAbo || sample.bloodRh"> ({{sample.bloodAbo}}{{sample.bloodRh}}) </span></em>
            </td>
        </tr>
      </table>
    </div>
  </div>
</div>

