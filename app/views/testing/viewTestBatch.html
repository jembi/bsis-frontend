<span class="h3 page-header">Manage Test Batch</span>

<span ng-if="testBatch.status == 'Complete'" class="h4" style="float: right; margin-top: 5px; margin-bottom: 5px; padding-right: 15px;">
  <em><a href="" ng-click="releaseTestBatch()">Release Batch</a> </em>|<em> <a href="" ng-click="closeTestBatch()">Close Batch</a></em></small>
</span>

<span ng-if="testBatch.status!='CLOSED'" class="h4" style="float: right; margin-top: 5px; padding-right: 15px;">
  <span has-permission="{{permissions.ADD_TTI_OUTCOME}}">
    <em><button class="btn btn-link" style="padding:0;" ng-click="recordTestResults(testBatch, 'tti')">Record TTI Test Results</button></em>
  </span>
  <span has-permissions="{{permissions.ADD_TTI_OUTCOME}};{{permissions.ADD_BLOOD_TYPING_OUTCOME}}"> | </span>
  <span has-permission="{{permissions.ADD_BLOOD_TYPING_OUTCOME}}">
    <em><button class="btn btn-link" style="padding:0;" ng-click="recordTestResults(testBatch, 'bloodGrouping')">Record Blood Group Serology Results</button></em>
  </span>
  | <em><button class="btn btn-link" style="padding:0;" ng-disabled="!testBatch.permissions.canRelease" ng-click="releaseTestBatch(testBatch)">Release Batch</button></em>
  | <em><button class="btn btn-link" style="padding:0;" ng-disabled="!testBatch.permissions.canClose" ng-click="closeTestBatch(testBatch)">Close Batch</button></em>
</span>


<hr style="clear:right;" />

<span class="h4" style="float: right; margin-top: 0px; margin-bottom: 0px; padding-right: 15px;">
  <span has-permissions="{{permissions.ADD_TTI_OUTCOME}}" ng-if="pendingBloodTypingTests || pendingTTITests"> <small><em><a href="" ng-click="recordPendingTestResults(testBatch)" >Record Confirmatory Test Results</a></em></small> </span>
  <span has-permissions="{{permissions.ADD_TTI_OUTCOME}};{{permissions.ADD_BLOOD_TYPING_OUTCOME}}" 
    ng-if="(pendingBloodTypingTests || pendingTTITests) && pendingBloodTypingMatchTests"> | </span>
  <span has-permission="{{permissions.ADD_BLOOD_TYPING_OUTCOME}}" ng-if="pendingBloodTypingMatchTests"> <small><em><a href="" ng-click="recordPendingBloodGroupMatchTests(testBatch)" >Record Confirmatory Abo/Rh Results</a></em></small> </span>
</span>

<div class="h4"> 
  <small><em>Created On: </em></small>{{testBatch.createdDate | bsisDateTime}}
  | 
  <small><em>Number of Samples: </em></small>{{testBatch.numSamples}}
</div>



<hr style="margin-bottom:5px;"/>
<span class="h4" style="font-size: 0.95em; margin-top:0px; margin-bottom:0px;" ng-repeat="donationBatch in testBatch.donationBatches"> 
  <small><em>Venue: </em></small>{{donationBatch.venue.name}} | <small><em>Date: </em></small> {{donationBatch.createdDate | bsisDate}} | <small><em>Number of Donations: </em></small> {{donationBatch.numDonations}}
  <br/>
</span>
<hr style="margin-top:5px;"/>

<div style="padding-bottom: 5px"></div>

<div class="col-sm-12">
  <div class="panel panel-default">
    <div class="panel-body">
        <p>
          <em>{{gridOptions.data.length}} sample(s) found</em>  | Filter data: 
          <select class="input-sm" ng-model="dataExportType" 
            ng-options="item as item.value for item in exportOptions" ng-change="filter(dataExportType)">
          </select>
          | <em> Data export: </em>
          
          <button class="btn btn-primary btn-ui-grid-export" ng-click="export('pdf')">PDF</button>
          <button class="btn btn-primary btn-ui-grid-export" ng-click="export('csv')">CSV</button>
        </p>
        <div class="grid" ui-grid="gridOptions" ui-grid-exporter ui-grid-pagination></div>
    </div>
  </div>
</div>

